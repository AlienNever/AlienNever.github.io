[{"title":"","date":"2018-11-09T15:14:47.192Z","path":"2018/11/09/20181105OCM Skillset4/","text":"","tags":[]},{"title":"11gOCM-Skillset6","date":"2018-11-06T04:00:00.000Z","path":"2018/11/06/20181113OCM Skillset6/","text":"Skillset 6TASKS:1. Grid Control Installation1.1 Deploy an Oracle Management Agent on your Database Server,management password is Oracle123.12345678910111213141516171819[oracle@edbjr2p2 linux]$ lsnrctl statusexport ORACLE_SID=PROD2sqlplus / as sysdbaalter user dbsnmp identified by oracle account unlock;cd /u01/app/oracle/product/middleware/oms11g/bin./emctl status oms./emctl start omscd /u01/app/oracle/product/middleware/oms11g/sysman/agent_download/11.1.0.1.0/linuxscp agentDownload.linux edbjr2p1:~[oracle@edbjr2p1 ~]$ chmod 755 agentDownload.linux./agentDownload.linux -yb /u01/app/oraclesu root/u01/app/oracle/agent11g/root.shcd /u01/app/oracle/agent11g/bin./emctl status agent https://localhost:7799/em sys Oracle123 1 1.2 Create a Grid Control super user called EMADMIN with the password EMADMIN. 1 2 3 4 2. Using Grid Control2.1 Using Grid Control, change the PGA_AGGREGATE_TARGET on your PROD1 server to 500MB so that it will persistant when the instance is restarted. 1 2 3 2.2 Using Grid Control, configure the instance to ensure that it will take up to five(5) minutes to recover your instance following an instance failure. 1 2.3 Configure an alert on the SYSTEM tablespace of the PROD1 database. The alert should register as a warning at 87% and critical at 95% full. 1 2.4 Setup notifications to be sent to the email address ‘dba@ocm.com’ Notification messages should be sent to this address at anytime. 1 2 3 2.5 Create a permanent tablespace REGISTRATION,local management tablespace,automatic segment space management Initial datafile size of 90M with the file expected to grow to 120M. 1 2 3 3. Implementing Schedules and Jobs3.1 Using Grid Control, create a schedule for the PROD1 database.3.1.1 Call this schedule DAILYREBUILD3.1.2 Configure it to run at 2PM every day 1 2 3 3.2 Create a program for the PROD1 database called EMP_IND_REBUILD that rebuilds all indexes on the HR.EMPLOYEES table.123456BEGIN FOR i IN (SELECT TABLE_OWNER,INDEX_NAME from user_indexes where TABLE_NAME=&apos;EMPLOYEES&apos;)LOOP EXECUTE IMMEDIATE &quot;ALTER INDEX&quot;||i.TABLE_OWNER||&quot;.&quot;||i.INDEX.NAME||&quot;REBUILD&quot;;END LOOP;END; 1 3.3 Create a window that utilizes the DAILYREBUILD schedule and SYSTEM_PLAN resource manager plan.1系统中无 SYSTEM_PLAN,可重新创建一个，或任选一个已有计划 1 2 3 3.4 Create a job called REBUILD_JOB that uses the DAILYREBUILD schedule and EMP_IND_REBUILD program. 1 2 3 4 5 6","tags":[{"name":"oracle","slug":"oracle","permalink":"https://aliennever.github.io/tags/oracle/"}]},{"title":"11gOCM-Skillset5","date":"2018-11-06T04:00:00.000Z","path":"2018/11/06/20181106OCM Skillset5/","text":"Skillset 5TASKS:1. PROD2 was destroyed again (implied)1.1 The data file that belongs to the system tablespace is deleted1.2 The controlfile is deleted12345list failure;advise failure;repair failure;ortar -xzvf PROD2.tar.gz 2. Create Synonym2.1 Create a sh.sales@PROD1 on the public synonyms in the PROD2, requires that all users can access.123create database link prod1 connect to sh identified by sh using &apos;PROD1&apos;;create public synonym sales for sh.sales@prod1;select count(*) from sales; 3. Set Up and Configure Resource Manager3.1 Assign the user SH as the resource administrator;123export ORACLE_SID=PROD1sqlplus / as sysdbagrant administer resource Manager to sh; 3.2 Create two resource manager consumer groups, OLTP and DSS (User comment which will be used for). 1 2 3.3 Create a plan named WEEKDAYS with the following derectives only:3.3.1 For OLTP group, we cannot allow more than 20 active sessions. If more than 20 sessions the request should be aborted if the wait exceeds 60 seconds.3.3.2 The maximum number of active sessions for the DSS group to 5. If more than 5 sessions then the request should be aborted after 120 seconds. 1 2 3.3.3 If more than 10000 times the I/O request and 2500M load on OLTP, switch to LOW_GROUP, if executed finished, to cut back to the original group (not estimated). 1 3.3.4 The maximum amount of undo that the OLTP group can use should be 200M(204800K); 1 3.3.5 Set CPU ratios for OLTP, DSS and OTHER_GROUPS as 50, 30 and 20 respectively. 1 3.3.6 DSS group has parallel degree limit of 20. 1 3.3.7 The idle session the longest 120s in the OLTP, if blocked above other process 80s, to termination. 1 3.4 Specify that the WEEKDAYS plan be used by the instance as default. 1 4. Management Objects for Performance4.1 Our application needs to access the CUST_LAST_NAME column in the CUSTOMERS table in the SH schema. The problem is that the users can supply names without regard to case. The application changes all the user-supplied names to uppercase. Analysis reveals that a normal index we placed on the column is not used. Create an index on the aforementioned column that will be usable by the application.123create index cust_up_lastname on sh.customers(upper(CUST_LAST_NAME));set autot trace expselect * from sh.customers where upper(cust_last_name)=&apos;HAUS&apos;; 4.2 Turn on monitoring for all of the indexes on the SALES table in the OLTP_USER schema.123456conn oltp_user/oltp_userselect INDEX_NAME from user_indexes where TABLE_NAME=&apos;SALES&apos;;alter index OLTP_SALES_PROD_BIX monitoring usage;alter index OLTP_SALES_CUST_BIX monitoring usage;alter index OLTP_SALES_CHANNEL_BIX monitoring usage;select * from v$object_usage; 4.3 Create two new tables named STUDENTS and ATTENDEES in the OLTP_USER schema. This STUDENTS table will contain three columns.STUD_ID will be a number and the primary key. FNAME and LNAME will be the other two columns and may vary in length with a maximun of 20 characters. ATTENDEES will be an intersection table in a many-to-many relationship between the STUDENTS and CLASSES tables also in the OLTP_USER schema. The ATTENDEES table will contain the primary keys of each of the other tables as its primary key. Create the ATTENDEES table so that the primary key index and the table itsellf are the same object.123456789create table STUDENTS(STUD_ID number primary key not null,FNAME varchar(20),Lname varchar(20));create table ATTENDEES(STUD_ID number not null constraint fk_stud_id references STUDENTS(STUD_ID),CLASS_ID number not null constraint fk_class_id references CLASSES(CLASS_ID),constraint pk primary key(STUD_ID,CLASS_ID))organization index; 4.4 Because of the unevenly distributed data in the DEPARTMENT_ID column of the EMPLOYEES table of the HR schema,you need to supply more information to the optimizer to allow for more efficient use of indexes. Regenerate statistics on the EMPLOYEES table to solve this problem.12345678910conn / as sysdbabegin DBMS_STATS.GATHER_TABLE_STATS ( ownname =&gt;&apos;HR&apos;, tabname =&gt;&apos;EMPLOYEES&apos;, method_opt =&gt; &apos;FOR ALL INDEXED COLUMNS SIZE AUTO&apos;, cascade =&gt;true); end; / 4.5 Analysis has revealed that the COUNTRY_ID column of the CUSTOMERS table of the SH schema has very low cardinality. This column is never updated. Create the index that can take advantage of the above attributes of this column.12conn sh/shcreate bitmap index cust_conun on CUSTOMERS(COUNTRY_ID); 4.6 create an index on the COUNTRY_ID and CUST_CITY column in the CUSTOMERS table of the SH schema.The application requires that leading column of this index must be the COUNTRY_ID column. Take advantage of the Oracle feature of indexes that allows the creation of the index to use less space when the leading column is not the most unique.1create index cust_count_city_i on customers(country_id,cust_city) compress 1; 4.7 Make certain that the package named STANDARD is always kept in memory.1234567conn / as sysdbabegin DBMS_SHARED_POOL.KEEP ( name=&gt;&apos;STANDARD&apos; ); end;/ 4.8 Analysis reveals that a 3rd party application is not using bind variables and has skewed data.In addition, we find shared pool latch contention. Find the best solution to reduce shared pool usage.1alter system set cursor_sharing=FORCE; 4.9 A junior dba create a table new_cust on tablespace cust_tbs. But you found it perform poorly and buffer busy wait is much higher than other tables on other tablespaces, and the segment head contention occurs. Try to resolve the problem but large query should be maintained. 1 2 3 4 5 6 7 8 4.10 The Product_id column of Product_information_part table is composed of sequence generation, requires the created the index of PROD_IDX, to improve the insertion performance.12conn sh/shCREATE INDEX PROD_IDX ON Product_information_part(Product_id) GLOBAL PARTITION BY HASH (Product_id) PARTITIONS 4; 4.11 Set sh.sales table not invalidate dependent cursors when do statistics collection.12345678beginDBMS_STATS.SET_TABLE_PREFS ( ownname =&gt; &apos;sh&apos;, tabname =&gt; &apos;sales&apos;, pname =&gt; &apos;NO_INVALIDATE&apos;, pvalue =&gt; &apos;true&apos;); end;/ 5. Use Result Cache5.1 Setting the cache 15m maximum.12conn / as sysdbaalter system set result_cache_max_size=15m; 5.2 To provide a SQL script, contains more than 2 SQL statements, the request to amend the query, the use of result cache.select department_id,sum(salary) from employees group by department_id;update employees set salary=salary+10 where department_id=20;commit;select department_id,sum(salary) from employees group by department_id;update employees set salary=salary+10 where department_id=60;commit;select department_id,sum(salary) from employees group by department_id;1234567891011conn hr/hrselect /*+ result_Cache*/ department_id,sum(salary) from employees group by department_id;update employees set salary=salary+10 where department_id=20;commit;select /*+ result_Cache*/ department_id,sum(salary) from employees group by department_id;update employees set salary=salary+10 where department_id=60;commit;set autot trace expselect /*+ result_Cache*/ department_id,sum(salary) from employees group by department_id;conn / as sysdbaselect ID,TYPE,STATUS,NAME from v$result_cache_objects; 6. Use multi column statistics6.1 The SQL statement suggesting that where conditional statements in columns used together often, requirements for SQL optimization.6.2 The sample SQL is as follows: SELECT count(*) FROM customers WHERE cust_city= ‘BJ’ and cust_state_province=’CA’ and country_id=52790;12conn sh/shcreate index cust_mult_i on customers(cust_city,cust_state_province,country_id); 6.3 Among them:cust_city,cust_state_province,country_id in customers are often in where clause together,how to improve performance.123456789conn / as sysdbabeginDBMS_STATS.GATHER_TABLE_STATS( ownname =&gt;&apos;SH&apos;, tabname =&gt;&apos;CUSTOMERS&apos;, METHOD_OPT =&gt;&apos;FOR ALL COLUMNS SIZE SKEWONLY FOR COLUMNS (cust_city,CUST_STATE_PROVINCE,COUNTRY_ID) SIZE SKEWONLY&apos;); end;/SELECT SYS.DBMS_STATS.SHOW_EXTENDED_STATS_NAME(&apos;sh&apos;,&apos;customers&apos;,&apos;(cust_city,cust_state_province,country_id)&apos;)col_group_name FROM DUAL; 7. Use SQL Performance Analyze7.1 From the 10.2 migration to the 11g environment, provides a dump file (the user password: apps/Apps1234),Contains the Sql Tuning Set, requires the use of a tool for optimization in STS SQL, and the optimized SQL plan_table write in the execution plan 7.2 Dump file location for: /home/oracle/scripts,the file :appsandstage.dmp.7.3 Migration from 10.2.0.1 to 11.1.0.71create directory TUNE_RESULT AS &apos;/home/oracle/scripts&apos;; 1 2 3 4 5 6 8. Use SQL Plan Management feature8.1 To provide a SQL script, requirements that Envolve SQL Plan Baseline, SQL as follows:select last_name from emp where employee_id=100;12conn hr/hrselect last_name from emp where employee_id=100; 1 2 3 12create index id_inx on emp(employee_id);select last_name from emp where employee_id=100; 1 2 3 9. Implement instance caging9.1 This host is only 2 CPU, for PROD1 and PROD2, so to prevent the occurrence of resource competition.123456export ORACLE_SID=PROD1sqlplus / as sysdbaalter system set cpu_count=1;export ORACLE_SID=PROD2sqlplus / as sysdbaalter system set cpu_count=1;","tags":[{"name":"oracle","slug":"oracle","permalink":"https://aliennever.github.io/tags/oracle/"}]},{"title":"11gOCM-Skillset3","date":"2018-10-29T04:00:00.000Z","path":"2018/10/29/20181029OCM Skillset3/","text":"Skillset 3TASKS:1. PROD2 is corrupted(Implicit subject)1.1 Redo log is deleted.1.2 The datafile in the tablespace of users is deleted.1234rman target / catalog rcowner/rc@PROD4list failure;advise failure;repair failure; 2. Create DBLINK2.1 Create DBLINK, should query on the PROD2 database all the table under the system user in the PROD1 Database.12create database link prod2_l connect to system identified by oracle using &apos;prod2&apos;;select * from hr.jobs@prod2_l; 3. Manage Materialized Views to improve rewrite and refresh performance3.1 Adjust the materialized view(prod_cost_mv) statement, to support the refresh fast and query rewrite123456alter user hr identified by hr account unlock;select OWNER,MVIEW_NAME from dba_mviews where MVIEW_NAME=&apos;PROD_COST_MV&apos;;set long 1000;select QUERY from dba_mviews where MVIEW_NAME=&apos;PROD_COST_MV&apos;;CREATE DIRECTORY TUNE_RESULTS AS &apos;/home/oracle/scripts&apos;;alter system set query_rewrite_enabled=true; 使用dbms_advisor生成建视图的语句:VARIABLE task_cust_mv VARCHAR2(30);VARIABLE create_mv_ddl VARCHAR2(4000);EXECUTE :task_cust_mv := ‘cust_mv’;EXECUTE :create_mv_ddl := ‘CREATE MATERIALIZED VIEW cust_mv REFRESH FAST DISABLE QUERY REWRITE AS SELECT time_id, prod_subcategory,SUM( unit_cost) AS sum_units FROM sh.costs c, sh.products p WHERE c.prod_id = p.prod_id GROUP BY time_id, prod_subcategory’;EXECUTE DBMS_ADVISOR.TUNE_MVIEW(:task_cust_mv, :create_mv_ddl);set pagesize 100;SELECT STATEMENT FROM DBA_TUNE_MVIEW WHERE TASK_NAME=’cust_mv’;DROP MATERIALIZED VIEW SH.PROD_COST_MV;vi mv_create.sql 修改以上查询结果：表名改为sh.prod_cost_mv 开启查询重写ENABLE QUERY REWRITE123456789101112131415161718192021222324252627CREATE MATERIALIZED VIEW LOG ON &quot;SH&quot;.&quot;COSTS&quot; WITH ROWID, SEQUENCE(&quot;PROD_ID&quot;,&quot;TIME_ID&quot;,&quot;UNIT_COST&quot;) INCLUDING NEW VALUES;CREATE MATERIALIZED VIEW LOG ON &quot;SH&quot;.&quot;COSTS&quot; WITH ROWID, SEQUENCE (&quot;PROD_ID&quot;,&quot;TIME_ID&quot;,&quot;UNIT_COST&quot;) INCLUDING NEW VALUES；ALTER MATERIALIZED VIEW LOG FORCE ON &quot;SH&quot;.&quot;COSTS&quot; ADD ROWID, SEQUENCE(&quot;PROD_ID&quot;,&quot;TIME_ID&quot;,&quot;UNIT_COST&quot;) INCLUDING NEW VALUES;CREATE MATERIALIZED VIEW LOG ON &quot;SH&quot;.&quot;PRODUCTS&quot; WITH ROWID, SEQUENCE(&quot;PROD_ID&quot;,&quot;PROD_SUBCATEGORY&quot;) INCLUDING NEW VALUES;ALTER MATERIALIZED VIEW LOG FORCE ON &quot;SH&quot;.&quot;PRODUCTS&quot; ADD ROWID, SEQUENCE(&quot;PROD_ID&quot;,&quot;PROD_SUBCATEGORY&quot;) INCLUDING NEW VALUES;CREATE MATERIALIZED VIEW sh.prod_cost_mv REFRESH FAST WITH ROWID ENABLE QUERY REWRITE AS SELECT SH.PRODUCTS.PROD_SUBCATEGORY C1, SH.COSTS.TIME_ID C2, SUM(&quot;SH&quot;.&quot;COSTS&quot;.&quot;UNIT_COST&quot;) M1, COUNT(&quot;SH&quot;.&quot;COSTS&quot;.&quot;UNIT_COST&quot;) M2, COUNT(*) M3 FROM SH.PRODUCTS, SH.COSTS WHERE SH.COSTS.PROD_ID = SH.PRODUCTS.PROD_ID GROUP BY SH.PRODUCTS.PROD_SUBCATEGORY, SH.COSTS.TIME_ID; @mv_create.sql 查询重写验证： 123conn sh/shexplain plan for select c.time_id,p.prod_subcategory,SUM(unit_cost) as sum_units FROM costs c,products p where c.prod_id=p.prod_id group by time_id, prod_subcategory;select * from table(dbms_xplan.display); 快速刷新验证： 12345678910select * from sh.prod_cost_mv where C2=to_date(&apos;1998-01-08,00:00:00&apos;,&apos;yyyy-mm-dd hh24:mi:ss&apos;);insert into costs values(18,to_date(&apos;1998-01-08 00:00:00&apos;,&apos;yyyy-mm-dd hh24:mi:ss&apos;),999,3,1149.17,1639.39);commit;exec dbms_mview.refresh(&apos;PROD_COST_MV&apos;,&apos;F&apos;);select * from sh.prod_cost_mv where C2=to_date(&apos;1998-01-08,00:00:00&apos;,&apos;yyyy-mm-dd hh24:mi:ss&apos;);delete from costs where prod_id=18 and time_id=to_date(&apos;1998-01-08,00:00:00&apos;,&apos;yyyy-mm-dd hh24:mi:ss&apos;) AND UNIT_PRICE=1639.39;commit;select * from sh.prod_cost_mv where C2=to_date(&apos;1998-01-08,00:00:00&apos;,&apos;yyyy-mm-dd hh24:mi:ss&apos;);exec dbms_mview.refresh(&apos;PROD_COST_MV&apos;,&apos;F&apos;);select * from sh.prod_cost_mv where C2=to_date(&apos;1998-01-08,00:00:00&apos;,&apos;yyyy-mm-dd hh24:mi:ss&apos;); 4. Manage Transport of tablespaces across platforms4.1. Add a tablespace by using Transportable Feature of Data Pump Import (platform transportable tablespace)4.2. A dump file export from solaris platform and transfer tablespace to PROD14.3. All dumpfiles and datafile are under /home/oracle/scripts directory(/home/oacle/scripts/transport_tbs01.dbf,/home/oracle/scripts/EXPDAT_GENERATETTS000021.DMP)12345678910111213select PLATFORM_NAME from v$database;rman target / CONVERT DATAFILE &apos;/home/oracle/scripts/transport_tbs01.dbf&apos; TO PLATFORM=&quot;Linux IA (32-bit)&quot; FROM PLATFORM=&quot;Solaris[tm] OE (32-bit)&quot; DB_FILE_NAME_CONVERT=&apos;/home/oracle/scripts/&apos;, &apos;/u01/app/oracle/oradata/PROD1/&apos; PARALLELISM=4;sqlplus / as sysdbaselect * from dba_directories;create or replace directory DATA_PUMP_DIR as &apos;/home/oracle/scripts&apos;;create user TRANS_USER identified by oracle;grant connect,resource to TRANS_USER;impdp system DUMPFILE=EXPDAT_GENERATETTS000021.DMP DIRECTORY=data_pump_dir TRANSPORT_DATAFILES=/u01/app/oracle/oradata/PROD1/transport_tbs01.dbf LOGFILE=tts_import.logalter tablespace TRANS_TBS read write;select name from v$tablespace;conn TRANS_USER/oracleselect * from tab; 5. Configure a schema to support a star transformation query (/home/oracle/scripts/star.sql)123456789101112conn / as sysdbaalter user sh identified by sh account unlock;show parameter staralter system set star_transformation_enabled = true;conn sh/shdesc salescreate bitmap index sales_cust_bix on sales(cust_id) local;create bitmap index sales_time_bix on sales(time_id) local;create bitmap index sales_chan_bix on sales(channel_id) local;set autot trace exp@/home/oracle/scripts/star.sqlset autot off 6. Administer external tables6.1 Provides the control file(/home/oracle/scripts/prod_master.ctl) and data file (/home/oracle/scripts/prod_master.dat.gz),requires that creation an external table in SH12345678conn / as sysdbacreate table sh.prod_master as select * from hr.prod_master;vi /home/oracle/scripts/prod_master.ctl:注释掉预处理：PREPROCESSOR,将hr.prod_master修改为sh.prod_mastersqlldr userid=sh/sh control=/home/oracle/scripts/prod_master.ctl external_table=GENERATE_ONLY log=/home/oracle/scripts/extent_tab.logvi /home/oracle/scripts/extent_tab.log:将建表语句保存为cet.sql(vi编辑器下:e cet.sql),表名两边不加引号,表名前增加&apos;SH.&apos;,增加PREPROCESSOR &apos;SYS_SQLLDR_XT_TMPDIR_00000&apos;:&apos;uncompress.sh&apos; 最后加上&apos;;&apos;create directory SYS_SQLLDR_XT_TMPDIR_00000 AS &apos;/home/oracle/scripts/&apos;;@cet.sqlselect * from sh.SYS_SQLLDR_X_EXT_PROD_MASTER; 7. Configure and use parallel EXECution for queries7.1. Requirements for maximum parallel slaves is 100, Permanent slave of minimum number is 10%.12alter system set parallel_max_servers=100;alter system set parallel_min_percent=10 scope=spfile; 7.2. Require all SQL using parallel, cannot execute in parallel operation, the operation was aborted.1alter system set parallel_degree_policy=limited; 7.3. Set the table sh.sales parallel degree of 8, to ensure that the entire scene with the parallel degree.12alter table sh.sales parallel 8;alter session enable parallel dml; 7.4. The running time of less than 5 seconds, should not use parallel.1alter system set parallel_min_time_threshold=5; 7.5. Provides a script (/home/oracle/scripts/parallel.sql), modify the script and execution that using the sys user, the SQL statement which run the parallel, execution plan into the plan_table.1234567@?/rdbms/admin/utlxplan.sqlvi parallel.sql：在最开始添加：alter session enable parallel dml/在update后添加：/*+ parallel*/@/home/oracle/scripts/parallel.sql","tags":[{"name":"oracle","slug":"oracle","permalink":"https://aliennever.github.io/tags/oracle/"}]},{"title":"11gOCM-Skillset2","date":"2018-09-05T04:00:00.000Z","path":"2018/09/05/20180827OCM Skillset2/","text":"Skillset 2TASKS:1. Register the PROD1、PROD2 database with the catalog on prod412345678export ORACLE_SID=PROD1rman target / catalog rcowner/rc@PROD4register database;report schema;export ORACLE_SID=PROD2rman target / catalog rcowner/rc@PROD4register database;report schema; 2. Use Recovery Manager to Perform Database backups2.1 Perform a tablespace backup for database PROD1 using fast recovery area2.1.1 backup EXAMPLE tablespace2.1.2 section size 30M123456789101112export ORACLE_SID=PROD1sqlplus / as sysdbashow parameter recoveryalter system set db_recovery_file_dest=&apos;/u01/app/oracle/fast_recovery_area&apos; scope=spfile; alter system set db_recovery_file_dest_size=4G;select ARCHIVER from v$instance;shut immediatestartup mountalter database archivelog;alter database open;rman target / catalog rcowner/rc@PROD4backup tablespace example section size 30m; 2.2 Perform a backup for database PROD12.2.1 Backup whole database2.2.2 Backup TAG is “Q107”2.2.3 Backup directory to “/home/oracle/files”(Implied)2.2.4 Backup keep long time123mkdir -p /home/oracle/filesrman target / catalog rcowner/rc@PROD4backup database plus archivelog format &apos;/home/oracle/files/prod1_full_%u.bak&apos; tag &apos;Q107&apos; keep forever; 2.3 Perform a backup for database PROD2 using fast recovery area1234567891011121314export ORACLE_SID=PROD2sqlplus / as sysdbashow parameter recoveryalter system set db_recovery_file_dest=&apos;/u01/app/oracle/fast_recovery_area&apos; scope=spfile; alter system set db_recovery_file_dest_size=4G;select archiver from v$instance;shut immediatestartup mountalter database archivelog;alter database open;rman target / catalog rcowner/rc@PROD4backup database;sqlplus / as sysdbaalter system archive log current; 2.4 Reduce Overheads of Fast Incremental Backups on the PROD1 database1alter database enable block change tracking using file &apos;/home/oracle/files/bct.f&apos;; 3. Flashback Database3.1 Turn on Flashback Database for PROD1 database3.1.1 Configure a flash recovery area of 4GB3.1.2 Put your flash recovery area in /home/oracle/flash (you may have to create this diretory)123456mkdir -p /home/oracle/flashalter system set db_recovery_file_dest=&apos;/home/oracle/flash&apos; scope=spfile;alter system set db_recovery_file_dest_size=4g;alter database flashback on;shutdown immediatestartup 3.2 Leave your databases open for review.3.3 Execute a script (/home/oracle/scripts/s2_1.sql), flash backup to step of insert opration finish.1234567date@/home/oracle/scripts/s2_1.sqlalter table hr.regions enable row movement;alter table hr.locations enable row movement;select versions_startscn,versions_endscn,versions_operation,region_id,region_name from hr.regions versions between timestamp to_timestamp(&apos;2018-11-14 16:36:21&apos;,&apos;YYYY-MM-DD HH24:MI:SS&apos;) and to_timestamp(&apos;2018-11-14 16:38:00&apos;,&apos;YYYY-MM-DD HH24:MI:SS&apos;);flashback table hr.regions,hr.countries,hr.locations to scn 985839;select * from hr.regions;","tags":[{"name":"oracle","slug":"oracle","permalink":"https://aliennever.github.io/tags/oracle/"}]},{"title":"11gOCM-Skillset1","date":"2018-07-03T04:00:00.000Z","path":"2018/07/03/20180710OCM Skillset1/","text":"Skillset 1NOTE:1234Database Server and Management Server, user/pwd: oracle/ocm123if need root,use sudo oracle doc: /stage/.../English/index.htmThe root directory must be kept free space 15% TASKS:1. Create Database1.1 Create a database the SID name is PROD3 at Management Server. 设置环境变量： 12345vi .bash_profileexport ORACLE_BASE=/u01/app/oracleexport ORACLE_HOME=$ORACLE_BASE/product/11.2.0/db_1export PATH=$ORACLE_HOME/bin:/sbin:/user/sbin:$PATHsource .bash_profile 创建所需目录: 12mkdir -p $ORACLE_BASE/admin/PROD3/adumpmkdir -p $ORACLE_BASE/oradata/PROD3 生成密码文件： 12cd $ORACLE_HOME/dbsorapwd file=orapwPROD3 password=oracle entries=30 创建pfile参数文件： 12cat init.ora |grep -v ^#|grep -v ^$ &gt; initPROD3.oravi initPROD3.ora 12345678910111213141516db_name=&apos;PROD3&apos;memory_target=1Gprocesses = 150audit_file_dest=&apos;/u01/app/oracle/admin/PROD3/adump&apos;audit_trail =&apos;db&apos;db_block_size=8192db_domain=&apos;&apos;db_recovery_file_dest=&apos;/u01/app/oracle/fast_recovery_area&apos;db_recovery_file_dest_size=2Gdiagnostic_dest=&apos;/u01/app/oracle&apos;dispatchers=&apos;(PROTOCOL=TCP)&apos;open_cursors=300remote_login_passwordfile=&apos;EXCLUSIVE&apos;undo_tablespace=&apos;UNDOTBS1&apos;control_files = (/u01/app/oracle/oradata/PROD3/control01.ctl, /u01/app/oracle/oradata/PROD3/control02.ctl)compatible =&apos;11.2.0&apos; 生成spfile参数文件： 1234export ORACLE_SID=PROD3sqlplus / as sysdbacreate spfile from pfile;startup nomount; 执行创建数据库语句: 1234cd vi cd.sqlsqlplus / as sysdba@cd.sql 123456789101112131415161718192021222324CREATE DATABASE PROD3 USER SYS IDENTIFIED BY oracle USER SYSTEM IDENTIFIED BY oracle LOGFILE GROUP 1 (&apos;/u01/app/oracle/oradata/PROD3/redo01.log&apos;) SIZE 100M BLOCKSIZE 512, GROUP 2 (&apos;/u01/app/oracle/oradata/PROD3/redo02.log&apos;) SIZE 100M BLOCKSIZE 512, GROUP 3 (&apos;/u01/app/oracle/oradata/PROD3/redo03.log&apos;) SIZE 100M BLOCKSIZE 512 MAXLOGFILES 5 MAXLOGMEMBERS 5 MAXLOGHISTORY 1 MAXDATAFILES 100 CHARACTER SET AL32UTF8 NATIONAL CHARACTER SET AL16UTF16 EXTENT MANAGEMENT LOCAL DATAFILE &apos;/u01/app/oracle/oradata/PROD3/system01.dbf&apos; SIZE 325M REUSE SYSAUX DATAFILE &apos;/u01/app/oracle/oradata/PROD3/sysaux01.dbf&apos; SIZE 325M REUSE DEFAULT TABLESPACE users DATAFILE &apos;/u01/app/oracle/oradata/PROD3/users01.dbf&apos; SIZE 100M REUSE AUTOEXTEND ON MAXSIZE UNLIMITED DEFAULT TEMPORARY TABLESPACE temptbs1 TEMPFILE &apos;/u01/app/oracle/oradata/PROD3/temp01.dbf&apos; SIZE 20M REUSE UNDO TABLESPACE undotbs1 DATAFILE &apos;/u01/app/oracle/oradata/PROD3/undotbs1.dbf&apos; SIZE 200M REUSE AUTOEXTEND ON MAXSIZE UNLIMITED; 执行catalog.sql和catproc.sql脚本:12@?/rdbms/admin/catalog.sql@?/rdbms/admin/catproc.sql 2. Undo Management2.1 Setup automatic undo management in the PROD1 database to support the following requirements:2.1.1 Avoid ORA-01555 Snapshot too old errors for queries running up to 90 minutes on average.1alter system set undo_retention=5400; 2.1.2 The number or concurrent OLTP users will be approximately 120 during normal business hours.1alter system set processes=140 scope=spfile; 2.1.3 The number or concurrent batch processes that will run in the evenings and weekends will approximately 12 to 15.1alter system set job_queue_processes=15; 3. Server-sid Network Configuration3.1 Create a listener using the default listener name.3.2 The TCP/IP protocol will be used for all connections,Use the machine name (not the IP address) for host.3.3 This listener will listen on the default port3.4 Databases will be serviced by this listener.3.5 Add a second listener,named LSNR2,which will listen on port 1526.3.6 Set up the PROD1 instance to automatically register with the LSNR2.3.7 Start both listeners.1vi $ORACLE_HOME/network/admin/listener.ora 1234567891011121314151617181920212223242526LISTENER = (DESCRIPTION_LIST = (DESCRIPTION = (ADDRESS = (PROTOCOL = TCP)(HOST = edbjr2p1)(PORT = 1521)) ) )SID_LIST_LISTENER= (SID_LIST= (SID_DESC= (GLOBAL_DBNAME=PROD1.us.example.com) (ORACLE_HOME=/u01/app/oracle/product/11.2.0/dbhome_1) (SID_NAME=PROD1)))LSNR2 = (DESCRIPTION_LIST = (DESCRIPTION = (ADDRESS = (PROTOCOL = TCP)(HOST = edbjr2p1)(PORT = 1526)) ) )SID_LIST_LSNR2= (SID_LIST= (SID_DESC= (GLOBAL_DBNAME=PROD1.us.example.com) (ORACLE_HOME=/u01/app/oracle/product/11.2.0/dbhome_1) (SID_NAME=PROD1)))ADR_BASE_LISTENER =/u01/app/oracle/product/11.2.0/dbhome_1 1234lsnrctl startlsnrctl start LSNR2alter system set local_listener=&apos;edbjr2p1:1521&apos;,&apos;edbjr2p1:1526&apos;;alter system register; 4. Shared Server Configuration4.1 Configure the PROD1 database to support up to 300 sessions,reserving 100 for dedicated connections.12alter system set sessions=300 scope=spfile; alter system set shared_server_sessions=200; 4.2 Configure the PROD1 database to support:4.2.1 Dispatchers tcp 31alter system set DISPATCHERS = &apos;(PROTOCOL=TCP)(DISPATCHERS=3)&apos;; 4.2.2 Maximum of 10 dispatchers1alter system set max_dispatchers=10; 4.3 Configure the PROD1 database to support:4.3.1 Minimum of 10 shared server processes.1alter system set shared_servers=10; 4.3.2 Maximum of 30 shared server processes.1alter system set max_shared_servers=30; 5. Client-side Network configuration5.1 Create the client-side network configuration files Providing connect descriptors to your databases using local naming and easy connect methods:5.1.1 The prod1 alias should connect to the PROD1 instance using the default listener and always use a dedicated server connection.5.1.2 The prod2 alias should connect to the PROD2 instance using the default listener and always use a dedicated server connection.5.1.3 The prod3 alias should connect to the PROD3 instance using the default listener and always use a dedicated server connection.5.1.4 The prod4 alias should connect to the PROD4 instance using the default listener and always use a dedicated server connection.5.1.5 The EMREP alias should connect to the EMREP instance using the default listener and always use a dedicated server connection.5.1.6 The PROD1_S alias should connect to the PROD1 instance using the LSNR2 listener and use a shared server connection.5.1.7 The RACDB alias using host cluster01-scan.example.com should connect to the RAC and use a dedicated server connection.12show parameter service_namesvi $ORACLE_HOME/network/admin/tnsnames.ora 12345678910111213141516171819202122232425262728PROD1 = (DESCRIPTION = (ADDRESS_LIST =(ADDRESS = (PROTOCOL = TCP)(HOST = edbjr2p1)(PORT = 1521))) (CONNECT_DATA =(SERVER = DEDICATED)(SERVICE_NAME = PROD1)))PROD2 = (DESCRIPTION = (ADDRESS_LIST =(ADDRESS = (PROTOCOL = TCP)(HOST = edbjr2p1)(PORT = 1521))) (CONNECT_DATA =(SERVER = DEDICATED)(SERVICE_NAME = PROD2)))PROD3 = (DESCRIPTION = (ADDRESS_LIST =(ADDRESS = (PROTOCOL = TCP)(HOST = edbjr2p2)(PORT = 1521))) (CONNECT_DATA =(SERVER = DEDICATED)(SERVICE_NAME = PROD3)))PROD4 = (DESCRIPTION = (ADDRESS_LIST =(ADDRESS = (PROTOCOL = TCP)(HOST = edbjr2p2)(PORT = 1521))) (CONNECT_DATA =(SERVER = DEDICATED)(SERVICE_NAME = PROD4)))PROD1_S = (DESCRIPTION = (ADDRESS_LIST =(ADDRESS = (PROTOCOL = TCP)(HOST = edbjr2p1)(PORT = 1526))) (CONNECT_DATA =(SERVER = SHARED)(SERVICE_NAME = PROD1)))EMREP = (DESCRIPTION = (ADDRESS_LIST =(ADDRESS = (PROTOCOL = TCP)(HOST = edbjr2p2)(PORT = 1521))) (CONNECT_DATA =(SERVER = DEDICATED)(SERVICE_NAME = EMREP)))RACDB = (DESCRIPTION = (ADDRESS_LIST =(ADDRESS = (PROTOCOL = TCP)(HOST = cluster01-scan.example.com)(PORT = 1521))) (CONNECT_DATA =(SERVER = DEDICATED)(SERVICE_NAME = RACDB))) 6. Tablespace Creation and ConfigurationNote: tablespaces must be named as specified in each task to receive credit. 6.1 Create a temporary tablespace group that contains two temporary tablespaces to support batch processing,the creation of large indexes and analyzing tables,Use the following specifications:6.1.1 Temporary tablespace group named TEMP_GRP containing temporary tablespaces TEMP1 and TEMP2.6.1.2 Make TEMP_GRP the default temporary tablespace for all new users.12345create temporary tablespace TEMP1 tempfile &apos;/u01/app/oracle/oradata/PROD1/temp1.dbf&apos; size 50m tablespace group TEMP_GRP;create temporary tablespace TEMP2 tempfile &apos;/u01/app/oracle/oradata/PROD1/temp2.dbf&apos; size 50m tablespace group TEMP_GRP;alter database default temporary tablespace TEMP_GRP;select * from DATABASE_PROPERTIES;select name from v$tablespace; 6.2 Create a permanent tablespace to store sample test data. Use the following specifications:6.2.1 Tablespace name of EXAMPLE.6.2.2 Initial datafile size of 500MB with the file expected to grow to 2GB.6.2.3 Initial extent size of 1MB.6.2.4 next extent size of 1MB.6.2.5 segment space management freelist12create tablespace EXAMPLE1 datafile &apos;/u01/app/oracle/oradata/PROD1/example.dbf&apos; size 500m autoextend on next 1m maxsize 2g extent management local uniform size 1m segment space management manual;select tablespace_name,next_extent,initial_extent from dba_tablespaces; 6.3 Create a permanent tablespace to store indexes,Use the following specifications:6.3.1 Tablespace name of INDX6.3.2 File size of 40MB1create tablespace INDX datafile &apos;/u01/app/oracle/oradata/PROD1/indx.dbf&apos; size 40m autoextend on; 6.4 Create a permanent tablespace to store data collected from the various Oracle tools. Use the following Specification:6.4.1 Tablespace name of TOOLS.6.4.2 File size of 10MB.6.4.3 Initial extent size of 4MB.6.4.4 Next extent size of 4MB.1create tablespace TOOLS datafile &apos;/u01/app/oracle/oradata/PROD1/tools.dbf&apos; size 10m autoextend on next 4m extent management local uniform size 4m; 6.5 Create a permanent tablespace to store sample test data. Use the following specification:6.5.1 Tablespace name of TEST.6.5.2 Initial datafile size of 400MB with the file expected to grow to 4TB.6.5.3 Initial extent size of 10MB.6.5.4 Next extent size of 10MB.1create bigfile tablespace TEST datafile &apos;/u01/app/oracle/oradata/PROD1/test.dbf&apos; size 400m autoextend on next 10m maxsize 4t extent management local uniform size 10m; 6.6 Create and manage database configuration files. Triplex the controlfile to minimize recovery in case of disk drive failure.12345678show parameter controlalter system set control_files=&apos;/u01/app/oracle/oradata/PROD1/control01.ctl&apos;,&apos;/u01/app/oracle/oradata/PROD1/control02.ctl&apos;,&apos;/u01/app/oracle/oradata/disk/PROD1/control03.ctl&apos; scope=spfile;shut immediatemkdir -p $ORACLE_BASE/oradata/disk/PROD1cp $ORACLE_BASE/oradata/PROD1/control01.ctl $ORACLE_BASE/oradata/disk/PROD1/control03.ctlsqlplus / as sysdbastartupshow parameter control 7. Schema statistics and Parameter File Configuration7.1 Compute statistics for the HR schemas in the database with cost based optimization.1EXEC DBMS_STATS.GATHER_SCHEMA_STATS(ownname=&gt;&apos;hr&apos;) 7.2 Investigate the parameter file for reasonable sizes for each parameter listed. Add additional parameters as you deem necessary to support an PL/SQL file I/O optimal database environment. Add the following OS directory:’/home/oracle’,’/home/oracle/temp’,’/home/oracle/scripts’.12mkdir -p /home/oracle/scriptsalter system set utl_file_dir=&apos;/home/oracle/&apos;,&apos;/home/oracle/temp&apos;,&apos;/home/oracle/scripts&apos; scope=spfile; 8. Backup the database to prepare for complete recovery under all circumstances12345678export ORACLE_SID=PROD1sqlplus / as sysdbashut immediateexport ORACLE_SID=PROD2sqlplus / as sysdbashut immediatetar -czvf PROD1.tar.gz PROD1tar -czvf PROD2.tar.gz PROD2 9. Create and Manage a tablespace that uses NFS mounted file system file9.1 Create Database Server Directory /u02/oradata/prod1,Mapping to Management Server NFS,NFS Server network Path: /vol/oradata12345678mkdir -p /u02/oradata/prod1vi $ORACLE_HOME/dbs/oranfstabserver: edbjr2p2path: 192.168.233.129export: /vol/oradatamount: /u02/oradata/prod1cd $ORACLE_HOME/rdbms/lib/ make -f ins_rdbms.mk dnfs_on 9.2 Create a tablespace named test_tbs on NFS and check it worked.1234create tablespace test_tbs datafile &apos;/u02/oradata/prod1/dnfs01.dbf&apos; size 5m autoextend off;select * from v$dnfs_servers;select * from v$dnfs_files;select * from v$dnfs_channels; 10. Use Opatch to install patch on PROD410.1 Apply patch on PROD412345export PATH=$PATH:/u01/app/oracle/product/11.2.0/db_1/OPatchunzip p12834800_112030_LINUX.zip cd 12834800/opatch lsinventoryopatch apply online -connectString PROD4:sys:oracle 11. Use Grid Infrastructure to manage oracle databases and other resources11.1 Register PROD4,EMREP to Grid Infrastructure11.2 Register ASM,Listener to Grid Infrastructure1234567891011121314cd /u01/app/11.2.0/grid/bin./crs_stat -t./crsctl start has ./srvctl add database -d PROD4 -o $ORACLE_HOME./srvctl add database -d EMREP -o $ORACLE_HOMElsnrctl stop./srvctl add listener./srvctl add asm./crs_stat -t./srvctl start database -d prod4./srvctl start database -d emrep./srvctl start asm./srvctl start listener./crs_stat -t 11.3 Create ASM diskgroup: DATA use ASMDISK1-4,normal; FRA use ASMDISK5-8,extermal.12cd /u01/app/11.2.0/grid/bin/./asmca 1-11-1 1-11-2 12. Use Enterprise Manager Configuration Assistant(EMCA) utility (ImplSkillsetIEd subject)1234567alter user DBSNMP identified by oracle account unlock;alter user SYSMAN identified by oracle account unlock;emca -config dbcontrol db -repos recreateemctl status dbconsoleemctl start dbconsolecat $ORACLE_HOME/install/portlist.inihttps://localhost:1158/em/","tags":[{"name":"oracle","slug":"oracle","permalink":"https://aliennever.github.io/tags/oracle/"}]},{"title":"Weblogic安装补丁","date":"2018-04-20T04:00:00.000Z","path":"2018/04/20/20180420-Weblogic安装补丁/","text":"停止打PSU补丁的服务器上的所有weblogic服务 查看当前weblogic是打过PSU补丁： 进入D:\\Oracle\\Middleware\\wlserver_10.3\\server\\bin目录： 执行setWLSEnv.cmd(Linux下执行setWLSEnv.sh，设置环境变量) 执行java weblogic.version:weblogic.version12345678WebLogic Server 10.3.6.0.180417 PSU Patch for BUG27395085 THU FEB 21 18:34:42 IS T 2018WebLogic Server 10.3.6.0 Tue Nov 15 08:52:36 PST 2011 1441050Use &apos;weblogic.version -verbose&apos; to get subsystem informationUse &apos;weblogic.utils.Versions&apos; to get version information for all modules 若没打补丁则第一部分只有最后一行，上面可见已打过PSU补丁 查看详细信息，可看到已达补丁IDD:\\Oracle\\Middleware\\utils\\bsu&gt;bsu.cmd -prod_dir=D:\\Oracle\\Middleware\\wlserver_10.3 -status=applied -verbose -viewlinux:./bsu.sh -prod_dir=/home/weblogic/Oracle/Middleware/wlserver_10.3 -status=applied -verbose -view-prod_dir=D:\\Oracle\\Middleware\\wlserver_10.3 -status=applied -verbose -view12345678910111213141516171819202122232425262728293031323334 四月 20, 2018 11:30:36 上午 java.util.prefs.WindowsPreferences &lt;init&gt; WARNING: Could not open/create prefs root node Software\\JavaSoft\\Prefs at root 0 x80000002. Windows RegCreateKeyEx(...) returned error code 5. ProductName: WebLogic Server ProductVersion: 10.3 MP6 Components: WebLogic Server/Core Application Server,WebLogic Server/Admi nistration Console,WebLogic Server/Configuration Wizard and Upgrade Framework,WebLogic Server/Web 2.0 HTTP Pub-Sub Serve r,WebLogic Server/WebLogic SCA,WebLogic Server/WebLogic JDBC Drivers,WebLogic Server/Third Party JDBC Drivers,WebLogic S erver/WebLogic Server Clients,WebLogic Server/WebLogic Web S erver Plugins,WebLogic Server/UDDI and Xquery Support,WebLog ic Server/Evaluation Database,WebLogic Server/Workshop Code Completion SupportBEAHome: D:\\Oracle\\MiddlewareProductHome: D:\\Oracle\\Middleware\\wlserver_10.3PatchSystemDir: D:\\Oracle\\Middleware\\utils\\bsuPatchDir: D:\\Oracle\\Middleware\\patch_wls1036Profile: DefaultDownloadDir: D:\\Oracle\\Middleware\\utils\\bsu\\cache_dirJavaVersion: 1.6.0_29JavaVendor: SunPatch ID: GFWXPatchContainer: GFWX.jarChecksum: -2141599595Severity: optionalCategory: GeneralCR/BUG: 27395085Restart: trueDescription: WLS PATCH SET UPDATE 10.3.6.0.180417WLS PATCH SET UPDATE 10.3.6.0.180417 卸载已打过的PSU补丁，如没有打过PSU则忽略该步骤： D:\\Oracle\\Middleware\\utils\\bsu&gt;bsr.cmd -remove -patchlist=ZLNA -prod_dir=D:\\Oracle\\Middleware\\wlserver_10.3 官网下载最新的PSU，查看weblogic的安装目录D:\\Oracle\\Middleware\\utils\\bsu是否有cache_dir目录，无则新建目录cache_dir将下载的PSU解压到cache_dir中 修改bsu.cmd(linux下为bsu.sh)的内存大小，建议为1g，默认不修改会报错无法执行PSU脚本MEM_ARGS=-Xms1024m -Xmx1024m 进入D:\\Oracle\\Middleware\\utils\\bsu目录下执行操作D:\\Oracle\\Middleware\\utils\\bsujava -jar patch-client.jar -install -patch_download_dir=D:\\Oracle\\Middleware\\utils\\bsu\\cache_dir -patchlist=GFWX(cache_dir中jar包名) -prod_dir=D:\\Oracle\\Middleware\\wlserver_10.3Linux：./bsu.sh -install -patch_download_dir=/home/weblogic/Oracle/Middleware/utils/bsu/cache_dir -patchlist=GFWX -prod_dir=/home/weblogic/Oracle/Middleware/wlserver_10.3 for conflicts..123No conflict(s) detectedInstalling Patch ID: GFWX..Result: Success 启动weblogic服务验证","tags":[{"name":"weblogic","slug":"weblogic","permalink":"https://aliennever.github.io/tags/weblogic/"}]},{"title":"Oracle11g最小静默安装","date":"2018-03-05T04:00:00.000Z","path":"2018/03/05/20180305-Oracle11g最小静默安装/","text":"前期准备 软件环境： VM虚拟机：redhat Linux oracle11g安装包 单机环境需要准备所需依赖包packages 单机环境安装net-tools和unzip： 配置本地yum源 打开VMware,在CD/DVD设置选项中，将Redhat7镜像文件放入CD/DVD中 将虚拟光驱挂载到 /mnt 文件夹下 （确保虚拟光驱处于链接状态）mount /dev/sr0 /mnt /mnt/Packages下安装net-tools和unzip包 rpm -ivh net-tools 若修改主机名则在在/etc/hosts文件中添加主机名 1234vi /etc/sysconfig/networkHOSTNAME=Alienvi /etc/hosts127.0.0.1 localhost.localdomain localhost linuxhostname Alien 修改内核参数文件/etc/sysctl.conf: 1234567891011fs.aio-max-nr = 1048576fs.file-max = 6815744kernel.shmall = 2097152kernel.shmmax = 536870912kernel.shmmni = 4096kernel.sem = 250 32000 100 128net.ipv4.ip_local_port_range = 9000 65500net.core.rmem_default = 262144net.core.rmem_max = 4194304net.core.wmem_default = 262144net.core.wmem_max = 1048586 修改用户的限制文件/etc/security/limits.conf: 12345oracle soft nproc 2047oracle hard nproc 16384oracle soft nofile 1024oracle hard nofile 65536oracle soft stack 10240 单机环境通过FTP工具上传并安装依赖包packages rpm -Uvh * --nodeps 1yum -y install binutils compat-libcap1 compat-libstdc++-33 elfutils-libelf elfutils-libelf-devel gcc gcc-c++ glibc glibc-common glibc-devel glibc-headers ksh libaio libaio-devel libgcc libstdc++ libstdc++-devel libXi libXtst make sysstat unixODBC unixODBC-devel 创建Oracle用户和相应的属组 1234groupadd oinstallgroupadd dbauseradd -g oinstall -G dba oraclepasswd oracle 切换到oracle用户创建目录修改属组和权限 123mkdir -p /home/oracle/oracle11g/base #基目录mkdir -p /home/oracle/oracle11g/base/home #家目录mkdir -p /home/oracle/oracle11g/oraInventory #清单目录 配置oracle用户的环境变量，编辑 ~/.bash_profile： 123456export ORACLE_BASE=/home/oracle/oracle11g/baseexport ORACLE_HOME=$ORACLE_BASE/home export ORACLE_SID=orclexport PATH=$ORACLE_HOME/bin:$PATH:$HOME/bin export TNS_ADMIN=$ORACLE_HOME/network/admin export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$ORACLE_HOME/lib 上传oracle11g安装包并解压 12unzip p13390677_112040_Linux-x86-64_1of7.zip unzip p13390677_112040_Linux-x86-64_2of7.zip 安装数据库 修改静默安装响应文件/home/oracle/database/response/db_install.rsp: 123456789101112oracle.install.option=INSTALL_DB_SWONLY ORACLE_HOSTNAME=AlienUNIX_GROUP_NAME=oinstallINVENTORY_LOCATION=/home/oracle/oracle11g/oraInventorySELECTED_LANGUAGES=en,zh_CNORACLE_HOME=/home/oracle/oracle11g/base/homeORACLE_BASE=/home/oracle/oracle11g/baseoracle.install.db.InstallEdition=EEoracle.install.db.isCustomInstall=falseoracle.install.db.DBA_GROUP=dbaoracle.install.db.OPER_GROUP=oinstallDECLINE_SECURITY_UPDATES=true 启动静默安装程序./runInstaller -silent -ignorePrereq -responseFile /home/oracle/database/response/db_install.rsp 配置oracle监听./netca /silent /responsefile /home/oracle/database/response/netca.rsp 若启动报错 12345678910Oracle Net Services 配置: An unexpected error has been detected by HotSpot Virtual Machine: SIGSEGV (0xb) at pc=0x00007f2ad35f0b9d, pid=22693, tid=139822952867648 Java VM: Java HotSpot(TM) 64-Bit Server VM (1.5.0_17-b03 mixed mode) Problematic frame: C [libclntsh.so.11.1+0x62ab9d] snlinGetAddrInfo+0x1b1 An error report file with more information is saved as hs_err_pid22693.log If you would like to submit a bug report, please visit: http://java.sun.com/webapps/bugreport/crash.jsp ./netca: 行 178: 22693 已放弃 $JRE $JRE_OPTIONS -classpath $CLASSPATH oracle.net.ca.NetCA $* 尝试修改主机名： 1234vi /etc/sysconfig/networkHOSTNAME=Alienvi /etc/hosts127.0.0.1 localhost.localdomain localhost linuxhostname Alien 查看监听器状态：lsnrctl status 静默创建数据库:./dbca -silent -responseFile /home/oracle/database/response/dbca.rsp建库后实例检查： 12ps -ef | grep ora_ | grep -v grep | wc -lps -ef | grep ora_ | grep -v grep","tags":[{"name":"oracle","slug":"oracle","permalink":"https://aliennever.github.io/tags/oracle/"}]},{"title":"Linux虚拟机安装","date":"2018-03-01T04:00:00.000Z","path":"2018/03/01/20180301-Linux虚拟机安装/","text":"系统安装： 最小化安装： 打开VMware，新建虚拟机&gt;典型配置&gt;稍后安装操作系统&gt;Linux&gt;选择存储文件夹&gt;设置虚拟机磁盘容量&gt;完成 CD/DVD选择Linux系统镜像文件&gt;开启虚拟机&gt;Install Linux&gt;安装语言选择简体中文&gt;设定时间、配置分区(规划可以如下图)、配置网络&gt;网络和主机名选择连接&gt;设置root用户密码 安装桌面环境： 打开VMware,在CD/DVD设置选项中，将Redhat7镜像文件放入CD/DVD中 root用户下将虚拟光驱挂载到 /mnt 文件夹下 （确保虚拟光驱处于链接状态） 12[root@localhost ~]# mount /dev/sr0 /mntmount: /dev/sr0 is write-protected, mounting read-only 配置光盘为本地yum源 123456[root@localhost ~]# vi /etc/yum.repos.d/local.repo[local]name=localbaseurl=file:///mntenabled=1gpgcheck=0 查看组yum包\\安装桌面环境组件\\切换到图形化界面 123[root@localhost ~]# yum grouplist[root@localhost ~]# yum groupinstall -y &quot;Server with GUI&quot;[root@localhost ~]# startx 默认启动模式查看与切换 查看当前启动模式： systemctl get-default 桌面启动：systemctl set-default graphical.target 命令行启动：systemctl set-default multi-user.target 安装VMware tools: 虚拟机 &gt;&gt;客户机 &gt;&gt; 安装/升级 VMware Tools 挂载解压资源 1234567[root@localhost /]# cd /media/[root@localhost media]# mount /dev/cdrom /media mount: /dev/sr0 is write-protected, mounting read-only[root@localhost media]# cp VMwareTools-10.0.10-4301679.tar.gz /tmp[root@localhost media]# cd /tmp[root@localhost tmp]# chmod +x VMwareTools-10.0.10-4301679.tar.gz[root@localhost tmp]# tar zxf VMwareTools-10.0.10-4301679.tar.gz 安装并卸载CD-ROM 1234[root@localhost tmp]# cd vmware-tools-distrib/[root@localhost vmware-tools-distrib]# ./vmware-install.pl[root@localhost vmware-tools-distrib]# cd /[root@localhost /]# umount /media","tags":[{"name":"Linux","slug":"Linux","permalink":"https://aliennever.github.io/tags/Linux/"}]},{"title":"weblogic集群配置","date":"2018-02-26T04:00:00.000Z","path":"2018/02/26/20180226-weblogic集群配置/","text":"一、相关概念 服务器(Server): AdminServer：主要用于管理，包括应用部署，动态创建server，以及各种服务配置.所以集群环境下不会将应用、数据源等服务部署到AdminServer上面，因为AdminServer仅仅是充当管理者角色而已。运维过程中，还起到监控其它服务器状态的作用。 PorxyServer：主要受理各种外部请求，做负载均衡，将具体工作交给具体的服务器。所以集群环境下，也不会将应用部署到ProxyServer上。除weblogic自带负载均衡方式外，也可用Apache\\Nginx软负载或者F5硬负载等方式部署。 Server: 实际处理业务请求的服务器，把前段代理服务器上接受到的任务进行实际处理，处理完了反馈给客户端。 AdminServer只负责管理、ProxyServer负责受理分配、而普通的Server就负责处理业务请求。 集群(cluster):控制台里面配置的集群，仅仅用于设置server之间的多播通信。server之间使用多播通信，互相告诉自己状态是否可用。 计算机(machine):可选配置：控制台里面配置的计算机，仅仅用于配置“节点管理器”信息（地址、端口）。然后根据配置信息向节点管理器发送操作命令。 节点管理器(nodemanager):可选服务：节点管理器在集群架构中，不是必须的。它的作用是用来管理server的生命周期，如果没有使用节点管理器，那么集群中的所有server的启动、关闭等常用的操作，必须通过运行startManagedWebLogic.cmd\\stopManagedWebloigc.cmd脚本来完成(脚本路径：D:\\Oracle\\Middleware\\user_projects\\domains\\base_domain\\bin)。例如启动server1: 1234startManagedWebLogic server1 127.0.0.1:7001server1 启动的受管服务器的名称 address 该域的管理服务器的IP地址 port 该域的管理服务器的监听端口 所以有些集群环境下，你能看到有多少个server，就有多少个启动脚本，实际上就是执行上面这个命令。如果集群中的server分布在多台主机上面，那每次启动服务非常不方便，所以这时候，节点管理器就派上用场了，节点管理器负责管理本机server的启动、关闭等生命周期。 二、单机单域集群部署实例: 部署规划： 运行Server 主机Ip 访问port AdminServer 172.16.92.41 7001 PorxyServer 172.16.92.41 17000 Server1 172.16.92.41 17001 Server2 172.16.92.41 17002 其中AdminServer是总控制端，ProxyServer为负载分发代理服务器，server1、server2是集群中的两个服务节点。 创建服务器\\集群\\计算机: 登录weblogic控制台:通过域目录下startWebLogic脚本启动weblogic服务，浏览器localhost:7001/console进入weblogic控制台。 建立服务器(Sever):域结构&gt;环境&gt;服务器：分别输入ip\\port建立Server1\\Server2\\PorxyServer 建立集群(cluster)域结构&gt;环境&gt;集群：建立Cluster1，消息传送模式选多点传送，传送地址和端口默认。建好后点击Cluster1超链接&gt;服务器选项卡将Sever1\\Sever2加入到集群中。 建立计算机(machine):域结构&gt;环境&gt;计算机：建立Machine1,默认配置，建好后点击Machine1超链接&gt;服务器选项卡将Sever1\\Sever2\\PorxyServer加入到集群中。 部署服务：域结构&gt;部署：分别选择相应的项目路径部署Proxy项目和MyProject项目，MyProject项目为自建测试项目(若有数据源需要在域结构&gt;服务&gt;数据源中配置数据源)，Proxy项目为weblogic自带负载分发项目，只在WEB-INF目录下包含web.xml和weblogic.xml，相应代码如下： web.xml 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;web-app xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns=&quot;http://java.sun.com/xml/ns/javaee&quot; xsi:schemaLocation=&quot;http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd&quot; id=&quot;WebApp_ID&quot; version=&quot;2.5&quot;&gt; &lt;display-name&gt;WeblogicProxy&lt;/display-name&gt; &lt;!-- 配置web的servlet，拦截所有的请求，proxy内部会检测server的状态、负载情况，然后根据算法再将请求转发给具体的server处理 --&gt; &lt;servlet&gt; &lt;servlet-name&gt;HttpClusterServlet&lt;/servlet-name&gt; &lt;servlet-class&gt;weblogic.servlet.proxy.HttpClusterServlet&lt;/servlet-class&gt; &lt;init-param&gt; &lt;param-name&gt;WebLogicCluster&lt;/param-name&gt; &lt;param-value&gt;172.16.92.41:17001|172.16.92.41:17002&lt;/param-value&gt; &lt;/init-param&gt; &lt;init-param&gt; &lt;param-name&gt;DebugConfigInfo&lt;/param-name&gt; &lt;param-value&gt;ON&lt;/param-value&gt; &lt;/init-param&gt; &lt;init-param&gt; &lt;param-name&gt;verbose&lt;/param-name&gt; &lt;param-value&gt;true&lt;/param-value&gt; &lt;/init-param&gt; &lt;/servlet&gt; &lt;servlet-mapping&gt; &lt;servlet-name&gt;HttpClusterServlet&lt;/servlet-name&gt; &lt;url-pattern&gt;/&lt;/url-pattern&gt; &lt;/servlet-mapping&gt; &lt;servlet-mapping&gt; &lt;servlet-name&gt;HttpClusterServlet&lt;/servlet-name&gt; &lt;url-pattern&gt;*.jsp&lt;/url-pattern&gt; &lt;/servlet-mapping&gt; &lt;servlet-mapping&gt; &lt;servlet-name&gt;HttpClusterServlet&lt;/servlet-name&gt; &lt;url-pattern&gt;*.jspx&lt;/url-pattern&gt; &lt;/servlet-mapping&gt; &lt;servlet-mapping&gt; &lt;servlet-name&gt;HttpClusterServlet&lt;/servlet-name&gt; &lt;url-pattern&gt;*.htm&lt;/url-pattern&gt; &lt;/servlet-mapping&gt; &lt;servlet-mapping&gt; &lt;servlet-name&gt;HttpClusterServlet&lt;/servlet-name&gt; &lt;url-pattern&gt;*.html&lt;/url-pattern&gt; &lt;/servlet-mapping&gt; &lt;servlet-mapping&gt; &lt;servlet-name&gt;HttpClusterServlet&lt;/servlet-name&gt; &lt;url-pattern&gt;*.jpd&lt;/url-pattern&gt; &lt;/servlet-mapping&gt; &lt;servlet-mapping&gt; &lt;servlet-name&gt;HttpClusterServlet&lt;/servlet-name&gt; &lt;url-pattern&gt;*.jcx&lt;/url-pattern&gt; &lt;/servlet-mapping&gt; &lt;servlet-mapping&gt; &lt;servlet-name&gt;HttpClusterServlet&lt;/servlet-name&gt; &lt;url-pattern&gt;*.dtf&lt;/url-pattern&gt; &lt;/servlet-mapping&gt; &lt;servlet-mapping&gt; &lt;servlet-name&gt;HttpClusterServlet&lt;/servlet-name&gt; &lt;url-pattern&gt;*.jws&lt;/url-pattern&gt; &lt;/servlet-mapping&gt;&lt;/web-app&gt; weblogic.xml 12345&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;wls:weblogic-web-app xmlns:wls=&quot;http://xmlns.oracle.com/weblogic/weblogic-web-app&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd http://xmlns.oracle.com/weblogic/weblogic-web-app http://xmlns.oracle.com/weblogic/weblogic-web-app/1.3/weblogic-web-app.xsd&quot;&gt; &lt;wls:weblogic-version&gt;10.3.6&lt;/wls:weblogic-version&gt; &lt;wls:context-root&gt;/&lt;/wls:context-root&gt;&lt;/wls:weblogic-web-app&gt; 启动服务器节点 修改D:\\Oracle\\Middleware\\wlserver_10.3\\common\\nodemanager目录下nodemanager.properties 字段，将默认的ListenAddress=localhost D:\\Oracle\\Middleware\\wlserver_10.3\\server\\bin目录下的脚本installNodeMgrSvc.cmd，然后在计算机&gt;管理&gt;服务启动Oracle WebLogic NodeManager (D_Oracle_Middleware_wlserver_10.3)服务 进入weblogic控制台界面，选择服务器&gt;控制选项卡，勾选对应的托管服务器，就可以进行启动关闭等操作。 三、双机集群部署实例： 前期注意： 集群中的所有Server必须位于同一网段，并且必须是IP广播(UDP)可到达的; 集群中的所有Server必须使用相同的版本,包括 Service Pack; 集群中的Server必须使用永久的静态IP地址。动态IP 地址分配不能用于集群环境。如果服务器位于防火墙后面，而客户机位于防火墙外面，那么服务器必须有公共的静态IP地址，只有这样，客户端才能访问服务器; 部署规划： 运行Server 主机Ip 访问port AdminServer 172.16.92.41 7001 ProxyServer 172.16.92.41 17000 Server1 172.16.92.41 17001 Server2 172.16.92.42 17001 创建域： 172.16.92.41: 启动weblogic配置向导，创建weblogic域，选择可选配置选项卡选择’管理服务器’和’受管理服务器，集群和计算机’两个选项，依照上述规划进行建立。 启动weblogic控制台，登录管理服务，安装部署应用及代理服务.配置Jndi数据源。以上步骤注意地址一定输入准确的IP地址不要使用localhost！管理服务AdminServer监听地址为空！若本机有虚拟网卡需要禁用！ 172.16.92.42：启动weblogic配置向导，创建weblogic域，选择可选配置选项卡选择’管理服务器’和’受管理服务器，集群和计算机’两个选项，管理服务器IP选择172.16.92.41服务器名建立要与172.16.92.41上建立的相匹配(即Server2)，集群和计算机不用配置。 部署服务：分别选择相应的项目路径部署Proxy项目和MyProject项目，程序中调用Jndi时也需要使用准确的IP地址！","tags":[{"name":"weblogic","slug":"weblogic","permalink":"https://aliennever.github.io/tags/weblogic/"}]}]